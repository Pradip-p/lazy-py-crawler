{% extends "base.html" %}

{% block title %}Contact Support | Crawlio {% endblock %}

{% block head %}
<style>
    .contact-form {
        max-width: 600px;
        margin: -4rem auto 0;
        background: white;
        border: 1px solid var(--border-color);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        padding: 3rem;
        border-radius: 8px;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        font-weight: 700;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }

    .form-control {
        width: 100%;
        padding: 0.8rem;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        outline: none;
    }

    .form-control:focus {
        border-color: var(--slack-purple);
    }
</style>
{% endblock %}


{% block content %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "Home",
    "item": "https://pradipthapa.info.np"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "Contact",
    "item": "https://pradipthapa.info.np/contact"
  }]
}
</script>
<section class="hero" style="padding-bottom: 8rem;">
    <div class="container text-center">
        <h1 id="contactTitle">Connect with us</h1>
        <p id="contactSubtitle">Ready to scale your data extraction? Fill out the form below and our team will get back to you within 24 hours.</p>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="contact-form">
            <form id="contactForm">
                <div id="dynamicFields"></div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="fullName" class="form-control" placeholder="John" required>
                </div>
                <div class="form-group">
                    <label>Business Email</label>
                    <input type="email" id="email" class="form-control" placeholder="john@company.com" required>
                </div>
                <div class="form-group" id="messageGroup">
                    <label>Message</label>
                    <textarea id="message" class="form-control" style="height: 150px;"
                        placeholder="Tell us about your data needs..." required></textarea>
                </div>
                <button type="submit" id="submitBtn" class="btn-primary" style="width: 100%;">Send Message</button>
            </form>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const type = params.get('type');
        const prefilledEmail = params.get('email');

        const title = document.getElementById('contactTitle');
        const subtitle = document.getElementById('contactSubtitle');
        const dynamicFields = document.getElementById('dynamicFields');
        const submitBtn = document.getElementById('submitBtn');
        const messageGroup = document.getElementById('messageGroup');
        const emailInput = document.getElementById('email');

        if (prefilledEmail) {
            emailInput.value = prefilledEmail;
        }

        if (type === 'free-sample' || type === 'starter' || type === 'pro') {
            title.innerText = 'Get Your Free Sample Dataset';
            subtitle.innerText = "Experience the quality of our data first-hand. We'll deliver a custom sample within 24 hours.";
            submitBtn.innerText = 'Request Free Sample';

            dynamicFields.innerHTML = `
                <div class="form-group">
                    <label>Service Type</label>
                    <select id="serviceType" class="form-control" required>
                        <option value="ecommerce">E-commerce Price Monitoring</option>
                        <option value="real-estate">Real Estate Data Extraction</option>
                        <option value="lead-gen">Lead & Business Data</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Target Website or Niche</label>
                    <input type="text" id="targetWebsite" class="form-control" placeholder="e.g. Amazon.com or Real Estate in NSW" required>
                </div>
            `;

            // For starter/pro, we can also customize
            if (type === 'starter') title.innerText = 'Get Started with Starter Plan';
            if (type === 'pro') title.innerText = 'Upgrade to Pro Growth Plan';

            // Optional: Hide the default message field for samples
            // messageGroup.style.display = 'none';
            // document.getElementById('message').required = false;
        }

        document.getElementById('contactForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerText;

            submitBtn.innerText = 'Sending...';
            submitBtn.disabled = true;

            const serviceType = document.getElementById('serviceType')?.value;
            const targetWebsite = document.getElementById('targetWebsite')?.value;
            let finalMessage = document.getElementById('message').value;

            if (serviceType && targetWebsite) {
                finalMessage = `LEAD TYPE: ${type.toUpperCase()}\nSERVICE: ${serviceType}\nTARGET: ${targetWebsite}\n\nUSER MESSAGE: ${finalMessage}`;
            }

            const data = {
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                message: finalMessage
            };

            try {
                const response = await fetch('/contact', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    if (typeof showToast === 'function') {
                        showToast(result.message || 'Thank you! Your request has been sent.', 'success');
                    } else {
                        alert(result.message || 'Thank you! Your request has been sent.');
                    }
                    document.getElementById('contactForm').reset();
                } else {
                    const errorMsg = result.detail || 'Something went wrong. Please try again.';
                    if (typeof showToast === 'function') {
                        showToast('Error: ' + errorMsg, 'error');
                    } else {
                        alert('Error: ' + errorMsg);
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                if (typeof showToast === 'function') {
                    showToast('Failed to connect to the server.', 'error');
                } else {
                    alert('Failed to connect to the server.');
                }
            } finally {
                submitBtn.innerText = originalText;
                submitBtn.disabled = false;
            }
        });
    });
</script>
{% endblock %}
